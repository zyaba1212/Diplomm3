{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container">
    <div class="discussion-header">
        <h1 class="page-title">üí¨ –û–±—Å—É–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</h1>
        <p class="page-subtitle">–ü—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ –∏–¥–µ–∏, –æ–±—Å—É–∂–¥–∞–π—Ç–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–µ—Ç–∏, —É—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ –±–ª–æ–∫—á–µ–π–Ω</p>
        
        <div class="discussion-stats">
            <div class="stat">
                <span class="stat-number">{{ comments.count|default:"0" }}</span>
                <span class="stat-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</span>
            </div>
            <div class="stat">
                <span class="stat-number">{{ proposals.count|default:"0" }}</span>
                <span class="stat-label">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</span>
            </div>
            <div class="stat">
                <span class="stat-number">{{ users_online|default:"12" }}</span>
                <span class="stat-label">–û–Ω–ª–∞–π–Ω</span>
            </div>
        </div>
    </div>

    <div class="discussion-layout">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –§–æ—Ä–º–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
        <div class="comment-form-section">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
            <form id="comment-form" class="comment-form">
                <div class="form-group">
                    <label for="comment-content">–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <textarea id="comment-content" rows="5" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="comment-tags">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
                    <input type="text" id="comment-tags" placeholder="—Å–µ—Ç—å, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ">
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-primary">
                        üìù –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
                    </button>
                    <button type="button" class="btn-secondary" id="attach-wallet">
                        üîó –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                    </button>
                </div>
                
                <div class="wallet-required hidden" id="wallet-required">
                    <p class="warning">‚ö†Ô∏è –î–ª—è –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</p>
                    <button type="button" class="btn-wallet-small" id="connect-for-comment">
                        –ü–æ–¥–∫–ª—é—á–∏—Ç—å Phantom Wallet
                    </button>
                </div>
            </form>
            
            <div class="proposal-cta">
                <h4>üìã –•–æ—Ç–∏—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–µ—Ç–∏?</h4>
                <p>–°–æ–∑–¥–∞–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–ª–æ–∫—á–µ–π–Ω-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</p>
                <a href="#" class="btn-special" id="create-proposal-btn">
                    üöÄ –°–æ–∑–¥–∞—Ç—å –±–ª–æ–∫—á–µ–π–Ω-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
                </a>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –°–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
        <div class="comments-section">
            <div class="comments-header">
                <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è</h3>
                <div class="sort-controls">
                    <select id="sort-by">
                        <option value="newest">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                        <option value="oldest">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                        <option value="popular">–°–Ω–∞—á–∞–ª–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
                    </select>
                    <button class="btn-refresh" id="refresh-comments">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>

            <div class="comments-list" id="comments-list">
                {% for comment in page_obj %}
                <div class="comment-item">
                    <div class="comment-header">
                        <div class="comment-author">
                            <div class="author-avatar-small">
                                {{ comment.user.nickname|slice:":2"|upper }}
                            </div>
                            <div class="author-info">
                                <span class="author-name">{{ comment.user.nickname }}</span>
                                <span class="comment-date">{{ comment.created_at|date:"d.m.Y H:i" }}</span>
                            </div>
                        </div>
                        {% if comment.user.wallet_address %}
                        <div class="wallet-badge" title="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π –∫–æ—à–µ–ª—ë–∫">
                            üîó {{ comment.user.wallet_address|slice:":6" }}...{{ comment.user.wallet_address|slice:"-4:" }}
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="comment-content">
                        {{ comment.content|linebreaks }}
                    </div>
                    
                    {% if comment.tags %}
                    <div class="comment-tags">
                        {% for tag in comment.tags.split %}
                        <span class="tag">#{{ tag }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <div class="comment-footer">
                        <div class="comment-votes">
                            <button class="vote-btn upvote" data-comment-id="{{ comment.id }}">
                                üëç <span class="vote-count">{{ comment.upvotes }}</span>
                            </button>
                            <button class="vote-btn downvote" data-comment-id="{{ comment.id }}">
                                üëé <span class="vote-count">{{ comment.downvotes }}</span>
                            </button>
                        </div>
                        <div class="comment-actions">
                            <button class="reply-btn" data-comment-id="{{ comment.id }}">
                                üí¨ –û—Ç–≤–µ—Ç–∏—Ç—å
                            </button>
                            {% if comment.user == request.user %}
                            <button class="edit-btn" data-comment-id="{{ comment.id }}">
                                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- –û—Ç–≤–µ—Ç—ã -->
                    {% if comment.replies %}
                    <div class="replies">
                        {% for reply in comment.replies %}
                        <div class="reply-item">
                            <div class="reply-author">
                                {{ reply.user.nickname }}:
                            </div>
                            <div class="reply-content">
                                {{ reply.content }}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% empty %}
                <div class="no-comments">
                    <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
                </div>
                {% endfor %}
            </div>

            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            {% if page_obj.has_other_pages %}
            <div class="pagination">
                {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}" class="page-link">‚Üê –ù–∞–∑–∞–¥</a>
                {% endif %}
                
                <span class="current-page">
                    –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
                </span>
                
                {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" class="page-link">–í–ø–µ—Ä—ë–¥ ‚Üí</a>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>

    <!-- –ë–ª–æ–∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π -->
    <section class="proposals-section">
        <h2 class="section-title">üéØ –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</h2>
        <div class="proposals-grid">
            {% for proposal in proposals|slice:":6" %}
            <div class="proposal-card">
                <div class="proposal-status-badge {{ proposal.status }}">
                    {{ proposal.get_status_display }}
                </div>
                <h4 class="proposal-card-title">{{ proposal.title }}</h4>
                <p class="proposal-card-desc">{{ proposal.description|truncatewords:30 }}</p>
                
                <div class="proposal-card-meta">
                    <span class="proposal-author">
                        üë§ {{ proposal.user.nickname|default:"–ê–Ω–æ–Ω–∏–º" }}
                    </span>
                    <a href="https://solscan.io/tx/{{ proposal.solana_tx_signature }}" 
                       class="proposal-tx-link" target="_blank">
                        üîó TX: {{ proposal.solana_tx_signature|slice:":10" }}...
                    </a>
                </div>
                
                <div class="proposal-card-actions">
                    <button class="btn-vote-proposal" data-proposal-id="{{ proposal.id }}">
                        üëç –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å
                    </button>
                    <span class="vote-count">+{{ proposal.votes|default:"0" }}</span>
                </div>
            </div>
            {% empty %}
            <div class="no-proposals">
                <p>–ü–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ!</p>
            </div>
            {% endfor %}
        </div>
    </section>
</div>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–±—Å—É–∂–¥–µ–Ω–∏—è */
.discussion-header {
    text-align: center;
    margin-bottom: 40px;
    padding-bottom: 30px;
    border-bottom: 2px solid rgba(153, 69, 255, 0.3);
}

.page-title {
    font-size: 2.5rem;
    margin-bottom: 10px;
    background: linear-gradient(135deg, #9945FF, #14F195);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.page-subtitle {
    color: #aaa;
    font-size: 1.1rem;
    margin-bottom: 30px;
}

.discussion-stats {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-top: 30px;
}

.stat {
    text-align: center;
}

.stat-number {
    display: block;
    font-size: 2rem;
    font-weight: bold;
    color: #14F195;
}

.stat-label {
    color: #aaa;
    font-size: 0.9rem;
}

/* Layout */
.discussion-layout {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 40px;
    margin-bottom: 60px;
}

@media (max-width: 992px) {
    .discussion-layout {
        grid-template-columns: 1fr;
    }
}

/* –§–æ—Ä–º–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è */
.comment-form-section {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 25px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.comment-form-section h3 {
    color: white;
    margin-bottom: 20px;
    font-size: 1.3rem;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    color: #aaa;
    margin-bottom: 8px;
    font-size: 0.9rem;
}

.form-group textarea,
.form-group input {
    width: 100%;
    padding: 12px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: white;
    font-family: 'CGXYZ PC', sans-serif;
    font-size: 0.95rem;
}

.form-group textarea {
    min-height: 120px;
    resize: vertical;
}

.form-actions {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
}

.btn-primary, .btn-secondary, .btn-wallet-small {
    padding: 12px 20px;
    border-radius: 25px;
    border: none;
    font-family: 'CGXYZ PC', sans-serif;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background: linear-gradient(135deg, #9945FF, #14F195);
    color: white;
    flex: 2;
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
    flex: 1;
}

.btn-wallet-small {
    background: linear-gradient(135deg, #9945FF, #14F195);
    color: white;
    font-size: 0.9rem;
    padding: 8px 15px;
}

.btn-primary:hover, .btn-secondary:hover, .btn-wallet-small:hover {
    transform: translateY(-2px);
}

.wallet-required {
    background: rgba(255, 193, 7, 0.1);
    border: 1px solid rgba(255, 193, 7, 0.3);
    border-radius: 10px;
    padding: 15px;
    margin-top: 20px;
}

.warning {
    color: #FFC107;
    margin-bottom: 10px;
    font-size: 0.9rem;
}

.proposal-cta {
    margin-top: 30px;
    padding: 20px;
    background: rgba(20, 241, 149, 0.1);
    border-radius: 10px;
    border: 1px solid rgba(20, 241, 149, 0.3);
}

.proposal-cta h4 {
    color: #14F195;
    margin-bottom: 10px;
}

.proposal-cta p {
    color: #aaa;
    margin-bottom: 15px;
    font-size: 0.9rem;
}

.btn-special {
    display: block;
    background: linear-gradient(135deg, #FF9900, #FF4444);
    color: white;
    text-decoration: none;
    padding: 15px 25px;
    border-radius: 25px;
    text-align: center;
    font-weight: bold;
    transition: transform 0.3s;
}

.btn-special:hover {
    transform: translateY(-2px);
}

/* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ */
.comments-section {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 25px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.comments-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
}

.comments-header h3 {
    color: white;
    font-size: 1.3rem;
}

.sort-controls {
    display: flex;
    gap: 15px;
    align-items: center;
}

#sort-by {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    padding: 8px 15px;
    border-radius: 20px;
    font-family: 'CGXYZ PC', sans-serif;
}

.btn-refresh {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    font-family: 'CGXYZ PC', sans-serif;
    display: flex;
    align-items: center;
    gap: 5px;
}

.comments-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-bottom: 30px;
}

.comment-item {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    padding: 20px;
    border-left: 4px solid #9945FF;
}

.comment-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
}

.comment-author {
    display: flex;
    align-items: center;
    gap: 12px;
}

.author-avatar-small {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #9945FF, #14F195);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: #0a0a1a;
    font-size: 0.9rem;
}

.author-info {
    display: flex;
    flex-direction: column;
}

.author-name {
    color: #14F195;
    font-weight: bold;
    font-size: 1rem;
}

.comment-date {
    color: #666;
    font-size: 0.8rem;
}

.wallet-badge {
    background: rgba(153, 69, 255, 0.2);
    color: #9945FF;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
    cursor: help;
}

.comment-content {
    color: #eee;
    line-height: 1.6;
    margin-bottom: 15px;
}

.comment-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 15px;
}

.tag {
    background: rgba(255, 255, 255, 0.1);
    color: #aaa;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
}

.comment-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.comment-votes {
    display: flex;
    gap: 10px;
}

.vote-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #aaa;
    padding: 6px 12px;
    border-radius: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: all 0.3s;
    font-size: 0.9rem;
}

.vote-btn:hover {
    background: rgba(153, 69, 255, 0.2);
    color: white;
}

.vote-count {
    font-weight: bold;
}

.comment-actions {
    display: flex;
    gap: 10px;
}

.reply-btn, .edit-btn {
    background: none;
    border: none;
    color: #aaa;
    cursor: pointer;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: color 0.3s;
}

.reply-btn:hover, .edit-btn:hover {
    color: #14F195;
}

.replies {
    margin-top: 20px;
    margin-left: 30px;
    border-left: 2px solid rgba(255, 255, 255, 0.1);
    padding-left: 20px;
}

.reply-item {
    background: rgba(255, 255, 255, 0.02);
    padding: 10px 15px;
    border-radius: 8px;
    margin-bottom: 10px;
}

.reply-author {
    color: #14F195;
    font-weight: bold;
    margin-bottom: 5px;
    font-size: 0.9rem;
}

.reply-content {
    color: #ccc;
    font-size: 0.9rem;
    line-height: 1.4;
}

/* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    padding: 20px 0;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.page-link {
    color: #14F195;
    text-decoration: none;
    padding: 8px 16px;
    border-radius: 20px;
    border: 1px solid rgba(20, 241, 149, 0.3);
    transition: all 0.3s;
}

.page-link:hover {
    background: rgba(20, 241, 149, 0.1);
}

.current-page {
    color: #aaa;
    font-size: 0.9rem;
}

/* –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è */
.proposals-section {
    margin-top: 60px;
    padding-top: 40px;
    border-top: 2px solid rgba(153, 69, 255, 0.3);
}

.section-title {
    text-align: center;
    font-size: 2rem;
    margin-bottom: 40px;
    color: white;
}

.proposals-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 25px;
}

.proposal-card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 25px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
    transition: transform 0.3s;
}

.proposal-card:hover {
    transform: translateY(-5px);
    border-color: #9945FF;
}

.proposal-status-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: bold;
}

.proposal-status-badge.pending {
    background: rgba(255, 193, 7, 0.2);
    color: #FFC107;
}

.proposal-status-badge.approved {
    background: rgba(20, 241, 149, 0.2);
    color: #14F195;
}

.proposal-status-badge.implemented {
    background: rgba(52, 152, 219, 0.2);
    color: #3498db;
}

.proposal-card-title {
    color: white;
    margin: 10px 0 15px 0;
    font-size: 1.2rem;
}

.proposal-card-desc {
    color: #aaa;
    line-height: 1.5;
    margin-bottom: 20px;
    font-size: 0.95rem;
}

.proposal-card-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    font-size: 0.9rem;
}

.proposal-author {
    color: #14F195;
}

.proposal-tx-link {
    color: #9945FF;
    text-decoration: none;
}

.proposal-tx-link:hover {
    text-decoration: underline;
}

.proposal-card-actions {
    display: flex;
    align-items: center;
    gap: 15px;
}

.btn-vote-proposal {
    background: linear-gradient(135deg, #9945FF, #14F195);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    font-family: 'CGXYZ PC', sans-serif;
    font-size: 0.9rem;
    transition: transform 0.3s;
}

.btn-vote-proposal:hover {
    transform: translateY(-2px);
}

.vote-count {
    color: #14F195;
    font-weight: bold;
    font-size: 1.1rem;
}

.no-comments, .no-proposals {
    text-align: center;
    padding: 60px 20px;
    color: #666;
    font-size: 1.1rem;
    background: rgba(255, 255, 255, 0.02);
    border-radius: 10px;
    border: 2px dashed rgba(255, 255, 255, 0.1);
}

.hidden {
    display: none !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ –¥–ª—è —Ñ–æ—Ä–º—ã
    const attachWalletBtn = document.getElementById('attach-wallet');
    const walletRequired = document.getElementById('wallet-required');
    const connectForComment = document.getElementById('connect-for-comment');
    
    if (attachWalletBtn) {
        attachWalletBtn.addEventListener('click', function() {
            if (window.walletConnector && window.walletConnector.isConnected) {
                // –ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω - –º–æ–∂–Ω–æ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                alert('–§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞!');
            } else {
                // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                walletRequired.classList.remove('hidden');
            }
        });
    }
    
    if (connectForComment) {
        connectForComment.addEventListener('click', function() {
            if (window.walletConnector) {
                window.walletConnector.connect();
            }
        });
    }
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
    const createProposalBtn = document.getElementById('create-proposal-btn');
    if (createProposalBtn) {
        createProposalBtn.addEventListener('click', function(e) {
            e.preventDefault();
            
            if (window.walletConnector && window.walletConnector.isConnected) {
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
                window.location.href = '/proposal/create/';
            } else {
                alert('–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫!');
                if (window.walletConnector) {
                    window.walletConnector.connect();
                }
            }
        });
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
    const refreshBtn = document.getElementById('refresh-comments');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
            window.location.reload();
        });
    }
    
    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
    const sortSelect = document.getElementById('sort-by');
    if (sortSelect) {
        sortSelect.addEventListener('change', function() {
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ AJAX –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
            console.log('–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ:', this.value);
        });
    }
});
</script>
{% endblock %}